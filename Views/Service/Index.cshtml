@{

}
<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
	<table class="table" style="margin-top:50px">
		<thead class="thead-primary">
			<tr class="bg-primary">
				<th scope="col" class="text-light">#</th>
				<th scope="col" class="text-light">Id</th>
				<th scope="col" class="text-light">Description</th>
				<th scope="col" class="text-light">Actions</th>
			</tr>
		</thead>
		<tbody id="dataTable"></tbody>
	</table>

	<button type="button" id="add" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addModal">Add</button>

	<!-- Add Modal -->
	<div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog bg-primary">
			<div class="modal-content ">
				<div class="modal-header bg-primary">
					<h5 class="modal-title">Add</h5>
					<button type="button" class="btn-close btn-danger" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<input type="text" id="description" class="form-control" placeholder="Enter a Description">
				</div>
				<div class="modal-footer bg-primary">
					<button type="button" id="close" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
					<button type="button" id="submit" class="btn btn-success">Submit</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Delete Modal -->
	<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header bg-danger">
					<h5 class="modal-title">Delete Service</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div>Are you sure to delete the service?</div>
					<div id="serviceId" style="display: none;"></div>
				</div>
				<div class="modal-footer bg-danger">
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
					<button type="button" id="deleteb" class="btn btn-warning">Delete</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Edit Modal -->
	<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header bg-warning">
					<h5 class="modal-title">Edit</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<input type="text" id="descriptionE" class="form-control">
				</div>
				<div class="modal-footer bg-warning">
					<button type="button" id="close" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
					<button type="button" id="editb" class="btn btn-success">Edit</button>
				</div>
			</div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
	<script defer>
		$(document).ready(function () {
			$("#add").click(function () {
				$("#addModal").modal("show");
			});

			$("#submit").click(function () {
				var service = {
					description: $('#description').val()
				};

				$.ajax({
					url: "/Service/SubmitAction",
					type: "POST",
					dataType: "json",
					data: service,
					success: function (element) {
						if (element.success) {
							alert('Success');
							LoadService();  // Refresh the list after submission
							$("#addModal").modal("hide");
						}
					},
					error: function (xhr, status, error) {
						alert('Something went wrong');
					}
				});
			});

			$(document).on("click", "#delete", function () {
				var row = $(this).closest("tr");
				var serviceId = row.find("td:eq(1)").text();

				$('#serviceId').data('id', serviceId);
				$("#deleteModal").modal("show");
			});

			$("#deleteb").click(function () {
				var serviceId = $('#serviceId').data('id');
				if (serviceId) {
					deleteService(serviceId);
				}
			});

			function deleteService(id) {
				$.ajax({
					url: '/Service/Delete',
					type: 'DELETE',
					data: { id: id },
					success: function (data) {
						if (data.success) {
							alert("Service deleted successfully!");
							LoadService();
							$("#deleteModal").modal("hide");
						} else {
							alert("Service not found.");
						}
					},
					error: function (xhr, status, error) {
						alert("An error occurred: " + error);
					}
				});
			}

			$(document).on("click", "#edit", function () {
					var row = $(this).closest("tr");
					var serviceId = row.find("td:eq(1)").text();  
					$('#descriptionE').val(row.find("td:eq(2)").text());
					$('#descriptionE').data('id', serviceId);
					$("#editModal").modal("show");
				});

			$("#editb").click(function () {
				var serviceId = $('#descriptionE').data('id');
				var updatedDescription = $('#descriptionE').val();

				updateService(serviceId, updatedDescription);
			});

			function updateService(id, updatedDescription) {
				const updatedData = {
					Id: id,
					Description: updatedDescription
				};

				$.ajax({
					url: `/Service/UpdateService`,
					type: 'POST',
					data: updatedData,
					success: function () {
						alert('Service data updated successfully');
						$('#editModal').modal('hide');
						LoadService();
					},
					error: function () {
						alert('Something went wrong');
					}
				});
			}


			function LoadService() {
				$.ajax({
					url: "/Service/GetList",
					type: "GET",
					success: function (data) {
						var tableBody = $("#dataTable");
						tableBody.empty();

						$.each(data, function (index, service) {
							var row = "<tr>" +
								"<td>" + (index + 1) + "</td>" +
								"<td>" + service.id + "</td>" +
								"<td>" + service.description + "</td>" +
								"<td>" +
								'<button type="button" id="delete" class="btn btn-outline-danger me-2" style="width:70px;">Delete</button>' +
								'<button type="button" id="edit" class="btn btn-outline-warning" style="width:70px;">Edit</button>' +
								"</td>" +
								"</tr>";
							tableBody.append(row);
						});
					},
					error: function () {
						alert("Something went wrong!");
					}
				});
			}

			LoadService(); 
		});
	</script>

	<footer class="footer bg-light text-center py-3">
		<div class="container">
			<span class="text-muted">&copy; @DateTime.Now.Year - Customer Management System</span>
		</div>
	</footer>
</body>
</html>
